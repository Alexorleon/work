{extends file='index.tpl.html'}
{block name=content}  

<link rel="stylesheet" href="{$tpl}css/main.css">
{literal}
<script>

    jQuery(function($)
    {
        $("#tabnum_lamp").focus();
        get_sotrud(0);
        go_timer();
    });

    function get_info_tab(tab_num)
    {
        var current_num = tab_num;
    // Получаем данные сотрудника
        get_sotrud(current_num);
        $("#tb_"+tab_num).addClass("tab_num_selected");
    }

    /*Обновляем таблу чувачков*/
    function get_sotrud(check_tab_num)
    {	//создал функцию, чтобы запускать по событию
        $.ajax({ //стартуем аякс
                type: 'POST', //обращаемся к скрипту методом ПОСТ
                data: {'type': '1', 'tabel_spusk': check_tab_num, 'window': $('#window').val(), 'shift': $('#shift').val(), 'date_lamp': $('#date_lamp').val()},
                url: "./inc/ajax.get_sotrud.lamp.php",//путь к скрипту, от корня
                error: function(req, text, error) {//обработчик, если произошла ошибка
                //console.log('Ошибка AJAX: ' + text + ' | ' + error);//выводим в консоль текст ошибки
                },
                success: function (data)
                         {
                            $("#sotruds").html(data);
                         }
               });
        if(check_tab_num !=0)
        {
            var id = $("#tabnum_lamp").val();
            $.ajax({ //стартуем аякс
                    type: 'POST', //обращаемся к скрипту методом ПОСТ
                    data: {'check_tab_num': check_tab_num, 'type': '2', 'date_lamp': $('#date_lamp').val()},
                    url: "./inc/ajax.get_sotrud.lamp.php",//путь к скрипту, от корня
                    error: function(req, text, error) {//обработчик, если произошла ошибка
				//console.log('Ошибка AJAX: ' + text + ' | ' + error);//выводим в консоль текст ошибки
				},
                    success: function (data)
                             {
                                 $("#tabnum_status").html(data);
                             }
                    });
        }
    }
function window_change()
{
    $("#tabnum_status").html("");
    get_sotrud(0);
}
    // нажатие enter
    $(document).ready(function()
                      {
                        $('#date_lamp').val(new Date().toDateInputValue());
                        $("#tabnum_lamp").keypress(function(e)
                        {
                            if(e.keyCode==13)
                            {
                                get_info_tab($("#tabnum_lamp").val());
                                $("#tabnum_lamp").val('');
                                stop_timers_to(10);
                            }
                        });
                      });
    Date.prototype.toDateInputValue = (function() {
    var local = new Date(this);
    local.setMinutes(this.getMinutes() - this.getTimezoneOffset());
    return local.toJSON().slice(0,10);
});

</script>
{/literal}
<div id="error_mess"> {$error_} </div>
<div id="lampDiv">

<form id="lamp" name="lamp" method="post">

<table style="width: 100%;">
<tr>
    <td><p style="margin-left: 20px;" align="left"><span class="title-lamp">Предсменный контроль</span></p></td>
</tr>
</table>

<p style="margin-left: 20px; margin-bottom: 0px;"><span>Поиск табельного</span></p>

<table>
<tr>
<td><input type="text" class="text_lamp" id="tabnum_lamp" name="tabnum_lamp" onkeypress="if((event.keyCode < 48)||(event.keyCode > 57)) event.returnValue=false"/></td>
<td><input type="date" id="date_lamp" onchange="window_change();"/></td>
<td><select class="text_lamp" name='current_shift' id='shift' onchange="window_change();">
        <option value='1'>1 смена</option>
        <option value='2'>2 смена</option>
        <option value='3'>3 смена</option>
    </select>
</td>
<td><select class="text_lamp" name='current_window' id='window' onchange="window_change();">
        <option value='1'>Окно №1</option>
        <option value='2'>Окно №2</option>
        <option value='3'>Окно №3</option>
    </select>
</td>
<td><span id="tabnum_status" class="status_search_tabnum"></span></td>
</tr>
</table>

<div id="sotruds" class="lamp_table">
</div>

</form>
</div>

<script src="{$tpl}js/script.js"></script>

{/block}