{extends file="list.tpl.html"}
{block name="article"}

<form id="edit_test" name="edit_test" method="post">

	{if $add_or_edit_test eq 0} <!-- новый тест -->
		
		<span class="title_menu_edit">Создание теста</span>
	{elseif $add_or_edit_test eq 1}

		<span class="title_menu_edit">Редактирование теста</span>
	{else}
		
		<span class="title_menu_edit">Добавление вопросов</span>
	{/if}
	
	<div style="margin-left: 2px;" align="left">
		<!--в зависимости от статуса добавляем или редактируем-->
		{if $add_or_edit_test eq 0} <!-- новый тест -->
		
			<a href="/list_tests"><input class="button_admin_edit" type="button" value="Назад" onclick=""/></a>
			<input class="button_admin_edit" type="button" value="Добавить тест" onclick="get_test('add_test', this.form)"/>
		{elseif $add_or_edit_test eq 1} <!-- редактирование -->

			<a href="/list_tests"><input class="button_admin_edit" type="button" value="Назад" onclick=""/></a>
			<input class="button_admin_edit" type="button" value="Сохранить изменения" onclick="get_test('save', this.form)"/>
			<input class="button_admin_edit" type="button" value="Добавить вопросы" onclick="get_test('add_question', this.form)"/>
		{else}
			<!--<a href="/edit_test?test_id={$cur_test_id}&test_title={$cur_test_title}&test_penalty={$cur_test_penalty}" style="cursor: pointer;"><input class="button_admin_edit" type="button" value="Назад" onclick="get_test('exit', this.form)"/></a>-->
			<input class="button_admin_edit" type="button" value="Назад" onclick="window.location='edit_test?test_id={$cur_test_id}&test_title={$cur_test_title}&test_penalty={$cur_test_penalty}&exit=exit'" style="cursor: pointer;"/>
		{/if}
	</div>
	
	{if $add_or_edit_test eq 0}
		<table>
			<tr>
				<td>Название:</td>
				<td><input class="field_text_edit" id="testname" name="testname" value="{if ($cur_test_title)}{$cur_test_title}{/if}"></td>
			</tr>
			<tr>
				<td>Штрафные баллы:</td>
				<td><input class="field_text_edit" id="testpenalty" name="testpenalty" value="{if ($cur_test_penalty)}{$cur_test_penalty}{/if}"></td>
			</tr>
		</table>
		
	{elseif $add_or_edit_test eq 1} <!-- редактирование -->

		<table>
			<tr>
				<td>Название:</td>
				<td><input class="field_text_edit" id="testname" name="testname" value="{if ($cur_test_title)}{$cur_test_title}{/if}"></td>
			</tr>
			<tr>
				<td>Штрафные баллы:</td>
				<td><input class="field_text_edit" id="testpenalty" name="testpenalty" value="{if ($cur_test_penalty)}{$cur_test_penalty}{/if}"></td>
			</tr>
		</table>
		
		<!-- формируем таблицу соотношей модулей для теста -->
		<table class="edit_tables_typeques">
			<tr>
				<th style="width: 20%;"></th>
				<th style="width: 20%;">Проверка знаний</th>
				<th style="width: 20%;">Проверка умений</th>
				<th style="width: 20%;">Проверка опыта</th>
				<th style="width: 20%;">Первая помощь</th>
			</tr>

			{section name=first start=0 loop=$active_modules_questions step=4}
				<tr>
					<td>
						{$active_modules_questions[{$smarty.section.first.index}]['TITLE']}
					</td>
					{section name=second start=$smarty.section.first.index loop=$active_modules_questions max=4}
						<td>
							{if $active_modules_questions[{$smarty.section.second.index}]['AMOUNT'] neq 0}

								<input class="check_text_edit" style="font-weight: bold;" id="arraytest_id{$active_modules_questions[{$smarty.section.second.index}]['ID']}" name="arraytest_id[{$active_modules_questions[{$smarty.section.second.index}]['ID']}]" value="{$active_modules_questions[{$smarty.section.second.index}]['AMOUNT']}">
							{else}
							
								<input class="check_text_edit" id="arraytest_id{$active_modules_questions[{$smarty.section.second.index}]['ID']}" name="arraytest_id[{$active_modules_questions[{$smarty.section.second.index}]['ID']}]" value="0">
							{/if}
						</td>
					{/section}
				</tr>
			{/section}
		</table>
		
		<p style="margin-left: 2px;"><span>Вопросы к этому тесту</span></p>
		
		<!-- Вопросы к этому тесту -->
		{$count = 0}
		<table class="edit_tables" id="questions_this_test">
				<thead>
			<tr>
				<th style="width: 4%;">№</th>
				<th style="width: 65%;">Вопрос</th>
				<th style="width: 10%;">Модуль</th>
				<th style="width: 10%;">Уровень риска</th>
				<th style="width: 10%;">Тип вопроса</th>
				<th style="width: 1%;"></th>
			</tr>
				</thead>
				<tbody>
			{section name=count loop=$questions_this_test}
				<!--<tr onclick="window.location='edit_tests?employee_id={$questions_this_test[{$count}]['SOTRUD_K']}&employee_cur={$questions_this_test[{$count}]['SOTRUD_FAM']}&employee_name={$questions_this_test[{$count}]['SOTRUD_IM']}&employee_pat={$questions_this_test[{$count}]['SOTRUD_OTCH']}&employee_tabel={$questions_this_test[{$count}]['TABEL_SPUSK']}&dolj={$questions_this_test[{$count}]['KOD']}'" style="cursor: pointer;">-->
				<tr>
					<td>
					{$questions_this_test[{$count}]['ID']}
					</td>
					<td>
					{$questions_this_test[{$count}]['TEXT']}
					</td>
					<td>
					{$questions_this_test[{$count}]['T_MODULE']}
					</td>
					<td>
					{$questions_this_test[{$count}]['T_RISK']}
					</td>
					<td>
					{$questions_this_test[{$count}]['T_TYPE']}
					</td>
					<td class="deleteInTable" style="text-align: center;">
					<a href="/edit_test?disabled_questionid={$questions_this_test[{$count}]['ID']}&test_id={$cur_test_id}&test_title={$cur_test_title}&test_penalty={$cur_test_penalty}" title="Удалить"><img src="files/img/del_table.png" alt="Удалить" align="center"/></a>
					</td>
					{capture}{$count++}{/capture}
				</tr>	
			{/section}
				</tbody>
		</table>
		<script>
			var table2_Props = {
								sort: true,
								mark_active_columns: true,
								col_0: "none",
								col_2: "select",
								col_3: "select",
								col_4: "select",
								col_5: "none",
								display_all_text: " [ Показать все ] ",
								sort_select: true,
								col_number_format: ['EU', null,null,null,null, 'EU']
							   };
			var tf2 = setFilterGrid("questions_this_test", table2_Props);
		</script>

	{else} <!-- добавление вопроса -->
	
		{$count = 0}
		<table class="edit_tables" id="question_list">
				<thead>
			<tr>
				<th style="width: 4%;">№</th>
				<th style="width: 66%;">Вопрос</th>
				<th style="width: 10%;">Модуль</th>
				<th style="width: 10%;">Уровень риска</th>
				<th style="width: 10%;">Тип вопроса</th>
			</tr>
				</thead>
				<tbody>
			{section name=count loop=$all_questions}
				<tr id="q_{$all_questions[{$count}]['ID']}" onclick="add_question({$all_questions[{$count}]['ID']})" style="cursor: pointer;">
					<td>
					{$all_questions[{$count}]['ID']}
					</td>
					<td>
					{$all_questions[{$count}]['TEXT']}
					</td>
					<td>
					{$all_questions[{$count}]['T_MODULE']}
					</td>
					<td>
					{$all_questions[{$count}]['T_RISK']}
					</td>
					<td>
					{$all_questions[{$count}]['T_TYPE']}
					</td>
					{capture}{$count++}{/capture}
				</tr>
			{/section}
				</tbody>
		</table>
		<script>
			var table2_Props = {
								sort: true,
								mark_active_columns: true,
								col_0: "none",
								col_2: "select",
								col_3: "select",
								col_4: "select",
								display_all_text: " [ Показать все ] ",
								sort_select: true,
								col_number_format: ['EU', null,null,null,null]
							   };
			var tf2 = setFilterGrid("question_list", table2_Props);
		</script>
	{/if}
	
	<!--  -->
	<!--<td><input type="hidden" id="employee_hidden_id" name="employee_hidden_id" value="{$cur_employee_id}"></td>-->

	<input id="status_edit_test" name="status_edit_test" type="hidden" value="save"/>
	<input id="cur_test_id" name="cur_test_id" type="hidden" value="{$cur_test_id}"/>
</form>

{/block}
{/extends}