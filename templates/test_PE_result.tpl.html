{extends file="list.tpl.html"}
{block name="article"}
<script src="{$js}chart/Chart.js"></script>
<h1>{$title}</h1>
<table class="simple-little-table" id="test_results_dir" cellspacing='0'>
    <tr>
        <th>Дата</th>
        <th>Модуль</th>
        <th>Вопрос</th>
        <th>Ответ</th>
        <th>Комментарий</th>
        <th>Штраф</th>
    </tr>
{assign var="price" value=0}
{assign var="amount" value=count($results)}
{assign var="chartDates" value="'{$results[0]['DATEBEGIN']}'"}
{assign var="chartPrices" value="{$results[0]['PRICE']}"}
{foreach from=$results key=key item=result}
{if $key != 0}
    {assign var="chartDates" value="{$chartDates}, '{$result['DATEBEGIN']}'"}
    {assign var="chartPrices" value="{$chartPrices}, {$result['PRICE']}"}
{/if}
    {if ($result['PRICE'] != 0)}
        {assign var="cls" value="class=wrong_ans"}
        {assign var="comment" value="{$result['COMMENTARY']} ({$result['FACTOR']})"}
    {else}
        {assign var="cls" value=""}
        {assign var="comment" value="Отвечено верно"}
    {/if}
    <tr {$cls}>
        <td>
            {$result['DATEBEGIN']}
        </td>
        <td>
            {$result['MTITLE']}
        </td>
        <td>
            {$result['QTEXT']}
        </td>
        <td>
            {$result['ATEXT']}
        </td>
        <td>
            {$comment}
        </td>
        <td>
            {$result['PRICE']}
        </td>
    </tr>
{assign var="price" value=$price+$result['PRICE']}
{/foreach}
</table>
<canvas id="peChart" width="800" height="400"></canvas>

{literal}
<script>
    var ctx = $('#peChart').get(0).getContext("2d");
    var chartOptions = {bezierCurve : false};
    var data = {
{/literal}
                labels: [{$chartDates}],
{literal}
                datasets:[
                {
                    label: "График ответов",
                    fillColor: "rgba(151,187,205,0.2)",
                    strokeColor: "rgba(151,187,205,1)",
                    pointColor: "rgba(151,187,205,1)",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(151,187,205,1)",
{/literal}
                    data: [{$chartPrices}]
{literal}
                }    
                ]
            
               };
    var peLineChart = new Chart(ctx).Line(data, chartOptions);
</script>
{/literal}
<div>
    Всего штрафных баллов: {$price}
</div>
<div>
    Средний балл: -{round($price/$amount)}
</div>
<button onclick='window.history.back()'>Назад</button>
{/block}
{/extends}
